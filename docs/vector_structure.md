
# ğŸ§  å‘é‡è³‡æ–™çµæ§‹èˆ‡æŸ¥è©¢è¨­è¨ˆï¼ˆVector Structure & RAG Metadataï¼‰

æœ¬æ–‡ä»¶èªªæ˜ ESG GPT é¡§å•ç³»çµ±ä¸­å‘é‡è³‡æ–™çš„è¨­è¨ˆã€å„²å­˜æ–¹å¼èˆ‡ metadata æ¬„ä½å®šç¾©ï¼Œå”åŠ©é–‹ç™¼è€…é€²è¡Œå»ºç½®ã€æŸ¥è©¢èˆ‡æ“´å……ã€‚

---

## ä¸€ã€è³‡æ–™ä¾†æºèˆ‡å»ºç½®æµç¨‹

å‘é‡è³‡æ–™ç”± `data/db_pdf_data/` ä¸­çš„ PDF è½‰æ›è€Œä¾†ï¼Œä½¿ç”¨ä¸‹åˆ—æµç¨‹è™•ç†ï¼š

1. é€é `PDFProcessor` å°‡ PDF åˆ†é ã€æ“·å–æ–‡å­—èˆ‡æ®µè½åˆ‡åˆ†
2. æ¯æ®µæ–‡å­—é€é `OpenAIEmbeddings` è½‰ç‚º 1536 ç¶­å‘é‡
3. åŒæ™‚ç”¢ç”Ÿ metadataï¼ˆæ®µè½æè¿°è³‡è¨Šï¼‰
4. å‘é‡èˆ‡ metadata ä¸€èµ·å„²å­˜åœ¨ FAISS å‘é‡åº«

---

## äºŒã€å„²å­˜æª”æ¡ˆä½ç½®

```bash
data/vector_output/
â”œâ”€â”€ faiss_index.index          # å„²å­˜å‘é‡çš„ä¸»é«”ï¼ˆç”± FAISS ç®¡ç†ï¼‰
â”œâ”€â”€ chunk_metadata.json        # å„²å­˜æ¯å€‹å‘é‡å°æ‡‰çš„ metadata
â”œâ”€â”€ vector_build_record.json   # å·²å»ºç½®æª”æ¡ˆçš„å¿«å–è¨˜éŒ„ï¼ˆé¿å…é‡è¤‡è™•ç†ï¼‰
â”œâ”€â”€ build_log.txt              # è™•ç†ç´€éŒ„èˆ‡éŒ¯èª¤è¨Šæ¯
```

---

## ä¸‰ã€æ¯ç­†æ®µè½è³‡æ–™åŒ…å«å“ªäº›æ¬„ä½ï¼Ÿ

æ¯å€‹å‘é‡æ®µè½çš„ metadata æ ¼å¼å¦‚ä¸‹ï¼š

```json
{
  "chunk_id": "ISO20400-p3-s2",
  "source": "ISO_20400_2017E.pdf",
  "path": "international/sustainable_procurement",
  "page": 3,
  "title": "3 Principles of sustainable procurement",
  "main_topic": "sustainability",
  "industry": "cross_industry",
  "region": "global",
  "language": "en"
}
```

---

## å››ã€æ¬„ä½å®šç¾©èªªæ˜

| æ¬„ä½åç¨±     | é¡å‹    | èªªæ˜èˆ‡ä¾†æº                                                       |
|--------------|---------|------------------------------------------------------------------|
| `chunk_id`   | string  | æ¯æ®µå”¯ä¸€ IDï¼Œæ ¼å¼ç‚º `æª”å-pé ç¢¼-sæ®µè½åºè™Ÿ`                      |
| `source`     | string  | åŸå§‹ PDF æª”å                                                    |
| `path`       | string  | ç›¸å°è³‡æ–™å¤¾è·¯å¾‘ï¼Œæ¨™ç¤ºè³‡æ–™åˆ†å€ï¼ˆå¦‚ `cases`, `international/...`ï¼‰ |
| `page`       | int     | æ­¤æ®µåŸå§‹å‡ºç¾åœ¨ PDF ç¬¬å¹¾é                                         |
| `title`      | string  | æ®µè½é¦–è¡Œæ–‡å­—ï¼ˆé è¨­ä½œç‚ºæ¨™é¡Œï¼‰                                     |
| `main_topic` | string  | ä¸»é¡Œåˆ†é¡ï¼ˆå¦‚ sustainability, climate, governance, socialï¼‰       |
| `industry`   | string  | å°æ‡‰ç”¢æ¥­åˆ†é¡ï¼ˆretail, logistics...ï¼‰                              |
| `region`     | string  | å€åŸŸï¼š`taiwan`ã€`global`ã€`unknown`                               |
| `language`   | string  | èªè¨€æ¨™è¨˜ï¼š`en` æˆ– `zh`ï¼ˆä¾ä¸­æ–‡å­—æ¯”ä¾‹åˆ¤æ–·ï¼‰                         |

---

## äº”ã€å»ºç½®æµç¨‹ä¾†æºæ¨¡çµ„

| æ¨¡çµ„åç¨±              | åŠŸèƒ½èªªæ˜                       |
|-----------------------|--------------------------------|
| `pdf_processor.py`     | åˆ†é ã€æ“·å–æ–‡å­—èˆ‡æ®µè½åˆ‡åˆ†       |
| `metadata_handler.py`  | æå–ä¸»é¡Œã€ç”¢æ¥­ã€åœ°å€ã€èªè¨€ç­‰æ¨™è¨˜ |
| `embeddings.py`        | å‘¼å« OpenAI API åšå‘é‡è½‰æ›     |
| `vector_store.py`      | å„²å­˜å‘é‡èˆ‡ metadata             |

---

## å…­ã€æŸ¥è©¢æ–¹å¼èˆ‡æ“´å……å»ºè­°ï¼ˆRAG æ‡‰ç”¨ï¼‰

æŸ¥è©¢å‘é‡åº«æ™‚ï¼Œå¯ç”¨çš„æª¢ç´¢æ¢ä»¶åŒ…å«ï¼š

- âœï¸ `metadata["main_topic"]`ï¼šåªæŸ¥æ°¸çºŒã€æ²»ç†æˆ–æ°£å€™ä¸»é¡Œæ®µè½
- ğŸŒ `metadata["region"]`ï¼šé™å®šå°ç£æˆ–åœ‹éš›ä¾†æº
- ğŸ¢ `metadata["industry"]`ï¼šåªå–é›¶å”®æ¥­æˆ–ç‰©æµæ¥­æ®µè½
- ğŸˆ `metadata["language"]`ï¼šå¯é‡å°ä¸­æ–‡æ®µè½å»ºç«‹æç¤º

---

## ä¸ƒã€å»ºè­°æ“´å……æ¬„ä½ï¼ˆé¸ç”¨ï¼‰

| æ¬„ä½åç¨±         | ç”¨é€”                             |
|------------------|----------------------------------|
| `source_url`     | ä¾†æºç¶²å€ï¼ˆè‹¥éæœ¬åœ° PDFï¼‰         |
| `created_at`     | å»ºç½®æ™‚é–“æˆ³                        |
| `content_hash`   | åŸå§‹æ®µè½æ‘˜è¦é›œæ¹Šï¼Œä¾›ç‰ˆæœ¬è¿½è¹¤ä½¿ç”¨ |
| `token_count`    | é ä¼° token æ•¸é‡ï¼ˆæ§åˆ¶æç¤ºæˆæœ¬ï¼‰   |

---

## å…«ã€FAISS æŸ¥è©¢ç¯„ä¾‹ï¼ˆå…§éƒ¨ç”¨é€”ï¼‰

```python
results = vector_store.index.search(
    query_vector,
    k=3
)

# å›å‚³å‘é‡ç›¸ä¼¼åº¦å‰ 3 åæ®µè½
# å¯ç”¨ results.metadata[i] æª¢æŸ¥ä¸»é¡Œèˆ‡ç”¢æ¥­
```

---

## âœ… æœ€ä½³å¯¦å‹™ç¸½çµ

- ğŸ“ å°‡å‘é‡åº«å„²å­˜èˆ‡åŸå§‹ PDF å®Œå…¨åˆ†é›¢
- âœ… metadata å¯éˆæ´»æ“´å……èˆ‡æŸ¥è©¢éæ¿¾
- ğŸš« é¿å…ä¸€æ¬¡æŸ¥å¤ªå¤šå‘é‡ï¼Œå»ºè­° k=3~5
- âœ¨ å¯æ­é…æç¤ºèª `You are given the following reference...` æå‡å›ç­”å¯ä¿¡åº¦

```

---
## âœ…å‘é‡è³‡æ–™åº«å·²ç¶“å»ºç«‹å®Œæˆäº†ï¼

ç³»çµ±å·²ç¶“æˆåŠŸç”Ÿæˆäº†ä¸‰å€‹æª”æ¡ˆï¼š
build_log.txt (1.7MB) - è™•ç†éç¨‹çš„æ—¥èªŒæª”æ¡ˆ
chunk_metadata.json (5.6MB) - åŒ…å«æ–‡ä»¶ç‰‡æ®µçš„å…ƒæ•¸æ“š
faiss_index.index (98MB) - å‘é‡è³‡æ–™åº«ç´¢å¼•æª”æ¡ˆ
æœ€çµ‚çµæœï¼š
æˆåŠŸè™•ç†äº†æ‰€æœ‰ PDF æª”æ¡ˆ
ç”Ÿæˆäº† 16,713 å€‹å‘é‡
æ‰€æœ‰è³‡æ–™éƒ½å·²ç¶“æˆåŠŸä¿å­˜ï¼š
å‘é‡è³‡æ–™åº«ç´¢å¼•ï¼ˆ98MBï¼‰
å…ƒæ•¸æ“šæª”æ¡ˆï¼ˆ5.6MBï¼‰
å®Œæ•´çš„è™•ç†æ—¥èªŒï¼ˆ1.7MBï¼‰
ç³»çµ±ç¾åœ¨å·²ç¶“æº–å‚™å¥½å¯ä»¥ä½¿ç”¨äº†ï¼
