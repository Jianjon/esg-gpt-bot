# Canvas L5：報告組段邏輯設計圖（Report Composition Logic）

本設計圖針對 ESG 題庫系統產出的報告內容進行結構設計，說明「回答資料 → 報告段落 → 建議內容」之間的對應關係，建立報告的產生規則、分類依據與輸出格式建議。

---

## 📄 報告分類與結構層次

目前分為：

### 🧪 初階報告（約 500 字）
- 自動摘要使用者在初階題組（25 題）之作答內容
- 選擇已回答題目的 `report_section` 分類作為段落標題
- 每段對應一組 `learning_goal + answer_tags` 作為產生建議語句的依據

### 📊 進階報告（約 1000 字）
- 整合初階 + 進階作答資料
- 報告可依題目分類（如 topic_category）或報告段落（report_section）進行分段
- 可加入：分析摘要、圖表生成（選填）、標準對標與改善建議

---

## 🔁 報告組段流程邏輯

```
[ 使用者完成作答 ]
        ↓
[ 擷取所有有回答的題目 ]
        ↓
[ 依 report_section 分群 ]
        ↓
For each group:
    1. 擷取回答內容（選項 / 自由輸入）
    2. 搭配 learning_goal 描述能力現況
    3. 參考 answer_tags 補強策略建議（未來可連結知識庫）
        ↓
[ 組合為：
  (1) 小段落標題：從 report_section 自動產出
  (2) 實況摘要：從作答內容 / learning_goal 撰寫
  (3) 建議語句：根據 answer_tags 補足減排或改善行動 ]
```

---

## 📌 段落範例結構（Markdown 標準格式）

```md
## 範疇一排放識別

您已能清楚辨識主要的能源與物料排放來源，包含電力、物流與包裝使用。

建議進一步建立每月排放紀錄機制，並探索替代性包材與在地採購策略。
```

---

## 🧩 對應欄位一覽

| 題庫欄位            | 報告用途                             |
|---------------------|--------------------------------------|
| `question_text`     | 可作為引用標題或背景引導                     |
| `report_section`    | 報告段落主分類，作為小節標題                   |
| `learning_goal`     | 作為「現況判斷／能力分析」的文字骨架             |
| `answer_tags`       | 決定報告中可能出現的建議句與對應策略內容（可與知識庫連動） |
| `option_X`          | 若有作答，作為現況內容引用                     |
| `free_answer_note`  | 若有自由輸入，則一併列入「現況描述」               |

---

## ✨ 延伸支援方向

- ✅ 加入「知識庫補強」策略（使用 answer_tags 查找具體建議）
- ✅ 自動合併相似段落（如重複提及同樣改善策略時）
- 📌 未來可支援報告語氣客製化（保守 / 積極 / 咨詢式）
- 📊 報告可輸出 HTML / PDF / JSON 結構（適用不同前端）

---

此 Canvas 為報告模組實作基礎，亦可導出為報告模板引擎規格、自然語言組合模板、圖表元件觸發器等。

